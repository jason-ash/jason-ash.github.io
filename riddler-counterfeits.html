<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	
	<title>Jason Ash | Thought Archive</title>
	<meta name="description" content="Writing about probability & Bayesian inference, data visualization, puzzles & games, finance, and books">	
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="theme/css/main.css">

	<!-- favicon -->
	<link href="data:image/x-icon;base64,AAABAAEAEBAAAAAAAABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAHwAAABcAAAAjAAAANAAAABQAAAAJAAAAAAAAAAAAAACxAAAA7QAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAKwAAADdAAAA7wAAAPcAAADuAAAAxwAAAJcAAAA7AAAA/wAAAP4AAAD/AAAAAAAAAAAAAAAAAAAAAAAAAEgAAADPAAAA/gAAAP8AAAD/AAAA/gAAAP8AAAD/AAAA/AAAAP8AAAD/AAAAwgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMwAAAPkAAAD9AAAA/wAAAP8AAAD+AAAA/wAAAP8AAAD/AAAA4AAAAEYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAAAQAAAAFgAAACMAAAA+AAAAP8AAAD/AAAA/wAAAP8AAAD/AAAAMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAGQAAAMUAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAJsAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADMAAAAswAAAHsAAAD/AAAA/wAAAP8AAAD+AAAAaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeAAAAAAAAAAAAAAAgwAAAP8AAAD+AAAA/gAAAN8AAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAADAAAAA/wAAAP8AAAD/AAAAVwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGQAAALMAAAD/AAAA/wAAAKIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAATgAAAI4AAABOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AAD//wAA/48AAICPAACADwAAwB8AAPgPAAD8BwAA/IcAAP+DAAD/wwAA/+EAAP/7AAD//wAA//8AAA==" rel="icon" type="image/x-icon" />
	
	<!-- Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-122705782-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());
	  gtag('config', 'UA-122705782-1');
	</script>

  </head>
  <body>
    
<nav class="navbar navbar-expand-sm navbar-light bg-white sticky-top">
  
  <div class="container">
  <a class="navbar-brand" href="/index">Jason Ash</a>
  
  <button class="navbar-toggler mt-1" type="button" data-toggle="collapse" data-target="#navbarNav">
        <i class="fa fa-bars"></i>
    </button>
  

  

  <div class="collapse navbar-collapse" id="navbarNav"> 
    <ul class="navbar-nav ml-auto">
      <li class="nav-item mr-4">
        <a class="nav-link" href="/index">Writing</a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="/resume" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Resume
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <a class="dropdown-item" href="/resume">View</a>
          <a class="dropdown-item" href="/resume.pdf" target="_blank">Download</a>
        </div>
      </li>
    </ul>
  </div>  
  </div>
  
</nav>    
    <div class="container" style="min-height:88vh">
<div class="row justify-content-center">
  <div class="col-md-8">
  
    <div class="row mt-5">
      <div class="col">
        <div class="d-flex justify-content-between align-items-baseline mb-4">
          <h1>Riddler Counterfeits</h1>
          <label class="text-muted">Aug 23, 2019</label>
        </div>
        <div class="mb-5">
          <p><h5>Introduction</h5>
<p>This week's <a href="https://fivethirtyeight.com/features/can-you-fool-the-bank-with-your-counterfeit-bills/" target="_blank">fivethirtyeight riddler</a> was created by yours truly! It was the first puzzle I've submitted to the riddler, and I hope you enjoyed it. This week we attempt to fool a bank with counterfeit hundred dollar bills. Here is the full text.</p>
<blockquote>
<p>You are an expert counterfeiter, and you specialize in forging one of the most ubiquitous notes in global circulation, the U.S. <span>&#0036;</span>100 bill. You’ve been able to fool the authorities with your carefully crafted C-notes for some time, but you’ve learned that new security features will make it impossible for you to continue to avoid detection. As a result, you decide to deposit as many fake notes as you dare before the security features are implemented and then retire from your life of crime.
<br><br>
You know from experience that the bank can only spot your fakes 25 percent of the time, and trying to deposit only counterfeit bills would be a ticket to jail. However, if you combine fake and real notes, there’s a chance the bank will accept your money. You have <span>&#0036;</span>2,500 in bona fide hundreds, plus a virtually unlimited supply of counterfeits. The bank scrutinizes cash deposits carefully: They randomly select 5 percent of the notes they receive, rounded up to the nearest whole number, for close examination. If they identify any note in a deposit as fake, they will confiscate the entire sum, leaving you only enough time to flee.
<br><br>
How many fake notes should you add to the <span>&#0036;</span>2,500 in order to maximize the expected value of your bank account? How much free money are you likely to make from your strategy?</p>
</blockquote>
<h5>Solution</h5>
<p>The counterfeiter wants to strike the optimum balance between profitability and risk. The ideal strategy will include as many fake notes as possible to maximize the size of the deposit, but not so many that the bank becomes aware of the fraud and seizes everything. </p>
<p>The ideal strategy is to <strong>add 55 fake notes to the 25 real notes</strong> for a total deposit of <span>&#0036;</span>8000. <strong>The expected gain from this strategy is <span>&#0036;</span>1256</strong>&#8224;, which is the weighted average of expected profit from successful deposits and expected losses from bank seizures. With 55 fake notes, there is a 47% chance we avoid detection and collect a profit of <span>&#0036;</span>5500 - the value of the fake notes we were able to sneak into circulation. (Remember we started with <span>&#0036;</span>2500, so only the fake notes count as profit.) There is a 53% chance we are caught by the bank and lose the <span>&#0036;</span>2500 in real dollars we used as decoys. </p>
<p>&#8224; A note on interpreting the results: I intended the problem to include the risk of <em>losing</em> <span>&#0036;</span>2500 if we are caught, and <em>gaining</em> the value of the fake notes if we are not. Therefore, the expected value would be $47\%\times5500-53\%\times2500=1256$. However, potentially to avoid some ambiguity, the problem was rewritten to ask "how much <strong>free money</strong> are you likely <strong>to make</strong> from your strategy?" I believe with that criteria, the answer should be $47\%\times5500=2582$, which includes only the value of the fake notes, and doesn't penalize losing the real ones. Another interpretation could count the original <span>&#0036;</span>2500 as free money as well (perhaps because it may have been the product of fraud at one point or another too!), for an answer of $47\%\times8000=3756$. I think all three are reasonable interpretations of the problem, but the first method is my favorite, so I'll continue that way.</p>
<p>How can we be sure no other strategy produces a higher profit? For example, suppose we combine 30 fake notes with 25 real notes instead. The bank will select three notes for its audit, which is 5% of 55, rounded up to the nearest whole number. Depending on our luck, the bank could choose all three fake notes, all three real notes, or some combination in between. </p>
<p>Let’s assume the bank randomly chooses two fake notes and one real note for its audit. This occurs with roughly 41.5% probability, given by the formula ${{3}\choose{2}}\times\frac{30}{55}\times\frac{29}{54}\times\frac{25}{53}$. Each fake note is detected 25% of the time, which means at least one fake note from the pool of two is detected $1-0.75^2=43.75\%$ of the time. We use similar logic to solve for the likelihood and detection rate of the audits with three fakes, one fake, and zero fake notes. The overall detection rate is equal to the weighted average across each potential audit.</p>
<p>For the 30 fake, 25 real strategy, the probability of success is 64.3%, and the probability of detection is 35.7%. Therefore, the expected profit is $64.3\%\times3000-35.7\%\times2500=1038$. That’s a decent payday, but we can do better. The chart below shows the profit for strategies with up to 200 fake notes, and it confirms the maximum is achieved when we use 55.</p>
<p><img class="img-fluid mx-auto d-block" src="../images/20190823-riddler.png"></p>
<p>We can see two patterns above. First, as we move to the right, we enter the “greedy danger zone,” where the bank becomes more likely to discover our fraud and seize the starting capital, resulting in larger and larger expected losses. Second, we see a sawtooth behavior caused by the bank’s practice of auditing 5% of deposited notes. The effect is significant: 55 is the ideal answer because we deposit 80 total notes, resulting in the bank auditing four. If we use 56 fake notes for a total of 81, then the bank audits five instead, which cuts the expected gain in half! A life of crime only pays if you’re good with numbers.</p>
<h5>Full Code</h5>
<p>The code this week is comprised of a single function that returns the expected value of a strategy with $n$ fake notes and $m$ real notes. There are optional parameters for the number of notes selected in an examination, the accuracy of the bank in detecting fake notes, and the denomination of bill used, with defaults set per the question. To generate a chart, run this model for the desired range of fake notes, e.g. 1 through 200, and plot the results.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">comb</span>

<span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="n">n_fake</span><span class="p">,</span> <span class="n">n_real</span><span class="p">,</span> <span class="n">selected</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">denomination</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the expected value of a strategy with n fake bills and m real bills.</span>

<span class="sd">    Final expected value is defined as </span>
<span class="sd">        * the value of the fake notes times the probability of not being caught</span>
<span class="sd">        * minus the value of the real notes times the probability of being caught.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_fake : int &gt; 0, the number of fake bills used</span>
<span class="sd">    n_real : int &gt; 0, the number of real bills used</span>
<span class="sd">    selected : float, between 0 and 1, the percent of bills examined by the bank,</span>
<span class="sd">        which will be applied to (n_fake + n_real), then rounded up to the nearest</span>
<span class="sd">        whole number</span>
<span class="sd">    accuracy : float, between 0 and 1, the likelihood of a bank detecting a fake </span>
<span class="sd">        note, given that it is examining that note</span>
<span class="sd">    denomination : int, the bill in question, e.g. $100, to multiply the result</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    expected_value : float, the expected value of the given strategy</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; model(n_fake=55, n_real=25, selected=0.05, accuracy=0.25, denomination=100)</span>
<span class="sd">    1256.8909531923773</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># number of notes randomly selected for inspection (rounded up to nearest whole)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="n">n_fake</span><span class="o">+</span><span class="n">n_real</span><span class="p">)</span><span class="o">*</span><span class="n">selected</span><span class="p">)</span>

    <span class="c1"># probabilities of choosing 0 through x fake notes in an examination</span>
    <span class="c1"># calculated by solving for the denominator and numerator separately,</span>
    <span class="c1"># then the (n choose k) component of each examination, and finally by</span>
    <span class="c1"># multiplying all three together for an overall likelihood factor.</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">n_real</span><span class="o">+</span><span class="n">n_fake</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)])</span>
    <span class="n">numerator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="n">n_fake</span> <span class="o">-</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">x</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">n_real</span> <span class="o">-</span> <span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">])</span>    
    <span class="n">combinations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">comb</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="n">combinations</span> <span class="o">*</span> <span class="p">(</span><span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">)</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># final likelihood of detection and corresponding expected value of payoffs</span>
    <span class="n">likelihood</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">1</span><span class="o">-</span><span class="n">accuracy</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">payoff</span> <span class="o">=</span> <span class="n">n_fake</span><span class="o">*</span><span class="n">likelihood</span> <span class="o">-</span> <span class="n">n_real</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">likelihood</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="n">payoff</span> <span class="o">*</span> <span class="n">denomination</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  
</pre></div></p>
        </div>
      </div>
    </div>

  </div>
</div>
    </div>     
    
<footer class="footer text-muted">
  <div class="container">    
    <p>
      Built with <a href="https://blog.getpelican.com/" target="_blank">Pelican</a> and <a href="https://getbootstrap.com/docs/4.0/getting-started/introduction/" target="_blank">Bootstrap</a>.
      <br>
      &copy; 2020 Jason Ash. All rights reserved.
    </p>
  </div>
</footer>	
	<!-- mathjax -->
    <script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  
    <!-- optional scripts -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
    
  
  </body>
</html>